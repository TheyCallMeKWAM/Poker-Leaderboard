<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Night Leaderboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>Poker Night Leaderboard</h1>
    </header>
    <main>
        <!-- Leaderboard Section -->
        <section id="leaderboard">
            <h2>Leaderboard</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Total Won/Lost</th>
                        <th>Games Played</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- Dynamic content will go here -->
                </tbody>
            </table>
        </section>

        <!-- All Players Graph Section -->
        <section id="all-players-graph-section">
            <h2>Performance of All Players</h2>
            <canvas id="all-players-graph" width="800" height="400"></canvas>
        </section>
    </main>
    <script>
        const players = [];
        const games = [];

        // Function to add game data
        function addGame(date, results) {
            results.forEach(({ name, result }) => {
                games.push({ date, name, result });
                let player = players.find(p => p.name === name);
                if (!player) {
                    player = { name: name, total: 0, games: 0, breakdown: [] };
                    players.push(player);
                }
                player.total += result;
                player.games += 1;
                player.breakdown.push({ gamesPlayed: player.games, total: player.total });
            });
        }

        // Function to populate leaderboard
        function populateLeaderboard() {
            const leaderboardBody = document.getElementById("leaderboard-body");

            // Clear existing content
            leaderboardBody.innerHTML = "";

            // Sort players by total winnings (descending)
            const sortedPlayers = [...players].sort((a, b) => b.total - a.total);

            // Populate leaderboard rows
            sortedPlayers.forEach((player, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td class="player-name" data-name="${player.name}">${player.name}</td>
                    <td>${player.total >= 0 ? `$${player.total}` : `-$${Math.abs(player.total)}`}</td>
                    <td>${player.games}</td>
                `;
                leaderboardBody.appendChild(row);

                // Add dropdown container row
                const dropdownRow = document.createElement("tr");
                dropdownRow.classList.add("dropdown-row");
                dropdownRow.style.display = "none"; // Hidden by default
                dropdownRow.innerHTML = `<td colspan="4" id="dropdown-${player.name}" class="dropdown-content"></td>`;
                leaderboardBody.appendChild(dropdownRow);

                // Add event listener for dropdown toggle
                const playerNameCell = row.querySelector(".player-name");
                playerNameCell.addEventListener("click", () => {
                    toggleDropdown(player.name);
                });
            });
        }

        // Function to toggle dropdown visibility
        function toggleDropdown(playerName) {
            const dropdownRow = document.querySelector(`#dropdown-${playerName}`).parentElement;
            if (dropdownRow.style.display === "none" || !dropdownRow.style.display) {
                const player = players.find(p => p.name === playerName);
                const dropdownContent = document.getElementById(`dropdown-${playerName}`);
                dropdownContent.innerHTML = player.breakdown
                    .map(entry => `<p>Game ${entry.gamesPlayed}: ${entry.total >= 0 ? `$${entry.total}` : `-$${Math.abs(entry.total)}`}</p>`)
                    .join("");

                // Plot player graph
                plotPlayerGraph(playerName);

                dropdownRow.style.display = "table-row";
            } else {
                dropdownRow.style.display = "none";
            }
        }

        // Function to plot a player's performance in the dropdown
        function plotPlayerGraph(playerName) {
            const dropdownContent = document.getElementById(`dropdown-${playerName}`);
            const canvasId = `graph-${playerName}`;

            // Create a canvas for the graph if it doesn't exist
            if (!document.getElementById(canvasId)) {
                const canvas = document.createElement('canvas');
                canvas.id = canvasId;
                canvas.width = 800;
                canvas.height = 400;
                dropdownContent.appendChild(canvas);
            }

            const player = players.find(p => p.name === playerName);
            const labels = [...new Set(games.map(game => game.date))]; // Unique dates
            const data = player.breakdown.map(entry => entry.total);

            // Create the chart
            new Chart(document.getElementById(canvasId), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: `${playerName}'s Performance`,
                    data: data,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true, // Ensures it scales with the container
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Games Played'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Total Won/Lost'
                        }
                    }
                }
            }
        });
        }

        // Function to plot all players' performances in a single graph
        function plotAllPlayersGraph() {
            const labels = [...new Set(games.map(game => game.date))]; // Unique dates
            const datasets = players.map(player => ({
                label: player.name,
                data: player.breakdown.map(entry => entry.total),
                borderColor: getRandomColor(),
                fill: false,
                tension: 0.4
            }));

            // Create the chart
            new Chart(document.getElementById('all-players-graph'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true, // Ensures it adjusts to screen size
                    maintainAspectRatio: true, // Keeps the aspect ratio consistent
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Games Played'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Total Won/Lost'
                            }
                        }
                    }
                }
            });
        }

        // Helper function to generate random colors
        function getRandomColor() {
            return `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 1)`;
        }

        // Example usage
        addGame("Jan 9th", [
            { name: "William", result: 50 },
            { name: "Michael", result: -81.30 },
            { name: "Warren", result: 0 },
            { name: "Kathy", result: 5 },
            { name: "Daniel", result: 0 },
            { name: "Aiden", result: 16.30 },
            { name: "Evan", result: 10 },
        ]);


        populateLeaderboard();
        plotAllPlayersGraph();
    </script>
</body>
</html>